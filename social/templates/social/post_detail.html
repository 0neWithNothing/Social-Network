{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
    {{ post.author.username }}
{% endblock %}

{% block body %}
<div class="container mt-5" style="width: 750px;">
    <div class="modal-content  rounded-4 shadow p-5">
        <div>{% include "social/post.html" %}</div>
        <div class='border-bottom pb-4'>
            {% if user.is_authenticated %}
                {% crispy comment_form %}
            {% else %}
            <div class="text-center">
                <a class="btn btn-outline-warning" href="{% url 'login' %}?next={{request.path}}">Log in to leave a comment!</a>
            </div>
            {% endif %}
        </div>
        {% for comment in comments %}
            <div class='border-bottom py-3'>
                <div class='row align-items-center'>
                    <div class="col-1 me-2">
                    {% if comment.author.avatar %}
                        <img src="{{ comment.author.avatar.url }}" alt="" class="border border-3 rounded-circle" style="max-width: 50px; min-height: 50px;">
                    {% else %}
                        <img src="{% static 'images/no-avatar.png' %}" alt="" class="border border-3 rounded-circle" style="max-width: 50px; min-height: 50px;">
                    {% endif %}
                    </div>
                    <div class="col">
                        <div class='fs-4'>@{{ comment.author.username }}</div>
                        <div class='text-secondary fs-6'>Replying to <a href="" class='text-decoration-none'>@{{ comment.post.author.username }}</a></div>
                    </div>
                    <div class="col align-self-start text-end">{{ comment.date }}</div>
                </div>
                <div class="row">
                    <div class="col-1 me-2"></div>
                    <div class="col fs-5">{{ comment.text }}</div>
                    <div class='col text-end'>
                        {% if user.is_authenticated %}
                        <form action="{% url 'comment-like' %}" method="POST">
                            {% csrf_token %}
                    
                            {% if comment in user.comment_like.all %}
                                <button type="submit" name="comment_id" value="{{comment.id}}" class="btn btn-link text-danger text-decoration-none p-0">
                                    <i class="bi bi-heart-fill warning"></i><span class="ms-1">{{ comment.number_of_likes }}</span>
                                </button>
                            {% else %}
                                <button type="submit" name="comment_id" value="{{comment.id}}" class="btn btn-link text-secondary text-decoration-none p-0">
                                    <i class="bi bi-heart"></i><span class="ms-1">{{ comment.number_of_likes }}</span>
                                </button>
                            {% endif %}
                        </form>
                        {% else %}
                            <a class="btn btn-outline-info" href="{% url 'login' %}?next={{request.path}}">Log in to like this!</a><br>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
        
    </div>
</div>
{% endblock %}